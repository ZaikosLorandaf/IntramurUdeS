<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="http://localhost:8180/js/keycloak.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/auth.js"></script>
        <script src="../script/auth.js"></script>
        <script src="../script/calls.js"></script>

        function removeTeam() {
            const div = document.getElementById('title');
            const span = div.firstElementChild;
            const nomLigue = document.getElementById("nomLigue").value;
            const nomTeam =document.getElementById("nomTeam").value;
            const nomSport = document.getElementById("nomSport").value;
            axios.get("http://localhost:8888/api/removeTeam/"+nomSport+"/"+ nomLigue +"/"+nomTeam, {})
                .then(function (response) {
                    span.innerHTML +=
                        '<br> nom : ' +  response.data + '</br>';
                })
                .catch(function (error) {
                    span.innerHTML += '<div>Erreur : ' + error + '</div>';
                });
        }

        function requestMessage() {
            const div = document.getElementById('title');
            const span = div.firstElementChild;
            axios.get("http://localhost:8888/api/getmessages/e24/s3i/app2", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(function (response) {
                    console.log("Response: ", response.status);
                    span.innerHTML = '';
                    for (let i in response.data) {
                        console.log(response.data[i]);
                        span.innerHTML +=
                            '<br> <strong>' + response.data[i].cip + '</strong>' +
                            '<br> <strong>' + response.data[i].description + '</strong> </br>'
                    }
                })
                .catch(function (error) {
                    console.log('refreshing');
                    keycloak.updateToken(5).then(function () {
                        console.log('Token refreshed');
                    }).catch(function () {
                        console.log('Failed to refresh token');
                    })
                });
            span.innerHTML = '<br> <strong>' + "Aucun message" + '</strong> </br>'
        }

        function addPlayer() {
            const div = document.getElementById('title');
            const span = div.firstElementChild;
            const nomTeam =document.getElementById("nomTeam").value;
            const nomSport = document.getElementById("nomSport").value;
            const nomLigue =document.getElementById("nomLigue").value;
            const prenomPlayer =document.getElementById("prenomPlayer").value;
            const nomPlayer =document.getElementById("nomPlayer").value;
            const number = document.getElementById("number").value;
            axios.post("http://localhost:8888/api/addPlayer/", {
                nomSport: nomSport,
                nomLigue: nomLigue,
                nomTeam: nomTeam,
                nom: nomPlayer,
                prenom: prenomPlayer,
                number: number
            })
                .then(function (response) {
                    span.innerHTML +=
                        '<br> nom : ' +  response.data + '</br>';
                })
                .catch(function (error) {
                    span.innerHTML += '<div>Erreur : ' + error + '</div>';
                });
        }

        function listPlayer() {
            const div = document.getElementById('title');
            const span = div.firstElementChild;
            const nomLigue =document.getElementById("nomLigue").value;
            const nomTeam =document.getElementById("nomTeam").value;
            const nomSport = document.getElementById("nomSport").value;
            axios.get("http://localhost:8888/api/listPlayer/" +nomSport+"/"+ nomLigue + "/" + nomTeam, {})
                .then(function (response) {
                    span.innerHTML +=
                        response.data;
                })
                .catch(function (error) {
                    span.innerHTML += '<div>Erreur : ' + error + '</div>';
                });
        }

        function removePlayer() {
            const div = document.getElementById('title');
            const span = div.firstElementChild;
            const nomLigue = document.getElementById("nomLigue").value;
            const nomTeam =document.getElementById("nomTeam").value;
            const prenomPlayer = document.getElementById("prenomPlayer").value;
            const nomPlayer = document.getElementById("nomPlayer").value;
            const nomSport = document.getElementById("nomSport").value;
            axios.get("http://localhost:8888/api/removePlayer/"+nomSport+"/"+ nomLigue +"/"+nomTeam+"/"+prenomPlayer+"/"+nomPlayer, {})
                .then(function (response) {
                    span.innerHTML +=
                        '<br> nom : ' +  response.data + '</br>';
                })
                .catch(function (error) {
                    span.innerHTML += '<div>Erreur : ' + error + '</div>';
                });
        }

        function logout() {
         //   let logoutURL = "http://localhost:8080//realms/usager/protocol/openid-connect/logout"
         //   window.location.href = logoutURL;
        }


    </script>
</head>
<body onload="checkAuth()">
<button onclick="requestStudent()">Ã‰tudiant?</button>
<button onclick="requestTeacher()">Enseignant?</button>
<button onclick="requestMessage()">Message app2?</button>
<button onclick="myAPI()" style="color: red;">Coucou mon ami</button>
<button onclick="myAPIJojojo()" style="color: red;">Jojojo</button>

        <!-- SPORTS -->
        <div>
            <button onclick="listSport()" style="color: blue;">List Sport</button>
            <button onclick="addSport()" style="color: red;">Add Sport</button>
            <button onclick="removeSport()" style="color: blue;">removeSport</button>
            <input
                    type="text"
                    id="nomSport"
                    size="20">
        </div>

        <!-- LEAGUES -->
        <div>
            <button onclick="listLeague()" style="color: red;">Lister Ligue</button>
            <button onclick="addLeague()" style="color: red;">Add Ligue</button>
            <button onclick="getLeague()" style="color: blue;">getLigue</button>
            <button onclick="removeLeague()" style="color: blue;">removeLigue</button>
            <input
                    type="text"
                    id="nomLigue"
                    size="20">
            <input
                    type="date"
                    id="date_debut"
                    size="20">
            <input
                    type="date"
                    id="date_fin"
                    size="20">
        </div>

        <!-- TEAMS -->
        <div>
            <button onclick="listTeam()" style="color: blue;">List Team</button>
            <button onclick="addTeam()" style="color: red;">Add Team</button>
            <button onclick="removeTeam()" style="color: blue;">removeTeam</button>
            <input
                    type="text"
                    id="nomTeam"
                    size="20">
        </div>

<!-- PLAYERS -->
<div>
    <button onclick="listPlayer()" style="color: blue;">List Player</button>
    <button onclick="addPlayer()" style="color: red;">Add Player</button>
    <button onclick="removePlayer()" style="color: blue;">removePlayer</button>
    <input
            type="text"
            id="prenomPlayer"
            size="20">
    <input
            type="text"
            id="nomPlayer"
            size="20">
    <input
            type="number"
            id="number"
            size="10">
</div>

        <div id="title">
            <span></span>
        </div>
    </body>
</html>
